1.Requirements
Django>=4.2
deepface
opencv-python
opencv-contrib-python
pandas
openpyxl
numpy
dlib
tensorflow
keras
2.manage.py
#!/usr/bin/env python
import os
import sys

def main():
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "myproject.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError("Couldn't import Django. Install and activate your venv.") from exc
    execute_from_command_line(sys.argv)

if __name__ == "__main__":
    main()
3.myproject
import os
from pathlib import Path

BASE_DIR = Path(__file__).resolve().parent.parent

SECRET_KEY = "replace-this-with-a-secure-secret-in-prod"

DEBUG = True

ALLOWED_HOSTS = []

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "voting_web",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

ROOT_URLCONF = "myproject.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "voting_web" / "templates"],
        "APP_DIRS": True,
        "OPTIONS": {"context_processors": [
            "django.template.context_processors.debug",
            "django.template.context_processors.request",
            "django.contrib.auth.context_processors.auth",
            "django.contrib.messages.context_processors.messages",
        ]},
    },
]

WSGI_APPLICATION = "myproject.wsgi.application"

# Simple DB just for Django internals (we're storing votes in Excel)
DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
    }
}

LANGUAGE_CODE = "en-us"
TIME_ZONE = "Asia/Kolkata"
USE_I18N = True
USE_TZ = True

STATIC_URL = "/static/"
STATICFILES_DIRS = [BASE_DIR / "voting_web" / "static"]

MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"

# Excel data folder
VOTING_DATA_DIR = BASE_DIR / "voting_web" / "data"
url:
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('voting_web.urls')),
]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
4.web url
from django.urls import path
from . import views

app_name = "voting_web"

urlpatterns = [
    path('', views.index, name='index'),
    path('visualize/login_po/', views.login_po, name='login_po'),
    path('visualize/panel_po/', views.panel, name='panel'),
    path('visualize/register_user/', views.register_user, name='register_user'),
    path('visualize/add_user/', views.add_user, name='add_user'),  # simple add
    path('visualize/vote_panel/', views.vote_panel, name='vote_panel'),
    path('increase_vote/', views.increase_vote, name='increase_vote'),
    path('visualize/reset_votes/', views.reset_votes, name='reset_votes'),
    path('show_results/', views.show_results, name='show_results'),
    path('verify_face/', views.verify_face, name='verify_face'),
]
5.views
import os
import json
import pandas as pd
from django.conf import settings
from django.shortcuts import render, redirect
from django.http import JsonResponse, HttpResponseBadRequest, HttpResponse
from django.views.decorators.csrf import csrf_exempt

# Face modules
from deepface import DeepFace
import cv2
import numpy as np
from datetime import datetime
from django.core.files.storage import default_storage
from django.core.files.base import ContentFile

DATA_DIR = settings.VOTING_DATA_DIR
POLL_LOGIN_XLSX = os.path.join(DATA_DIR, "pollingOfficerLogin.xlsx")
VOTES_XLSX = os.path.join(DATA_DIR, "Votes.xlsx")
REGISTERED_CSV = os.path.join(DATA_DIR, "registered.csv")
REGISTERED_DIR = os.path.join(settings.MEDIA_ROOT, "registered")

# Ensure dirs exist
os.makedirs(REGISTERED_DIR, exist_ok=True)
os.makedirs(DATA_DIR, exist_ok=True)

def index(request):
    return render(request, "voting_web/index.html")

def login_po(request):
    # Polling officer login (reads pollingOfficerLogin.xlsx)
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")
        if not os.path.exists(POLL_LOGIN_XLSX):
            return JsonResponse({"success": False, "message": "Login file missing."})
        df = pd.read_excel(POLL_LOGIN_XLSX)
        if any((df['username'] == username) & (df['password'] == password)):
            request.session['po_user'] = username
            return redirect('voting_web:panel')
        else:
            return render(request, "voting_web/login_po.html", {"error": "Invalid credentials"})
    return render(request, "voting_web/login_po.html")

def panel(request):
    # Panel for admin/polling officer
    if 'po_user' not in request.session:
        return redirect('voting_web:login_po')
    return render(request, "voting_web/panel_po.html")

def register_user(request):
    # Register a new voter (upload image & name)
    if request.method == "POST":
        name = request.POST.get("name")
        file = request.FILES.get("photo")
        if not name or not file:
            return JsonResponse({"success": False, "message": "Missing name or photo"})
        # Save image
        filename = f"{name}_{int(datetime.utcnow().timestamp())}.jpg"
        path = os.path.join(REGISTERED_DIR, filename)
        with open(path, "wb+") as dest:
            for chunk in file.chunks():
                dest.write(chunk)
        # Update registered.csv
        if os.path.exists(REGISTERED_CSV):
            reg_df = pd.read_csv(REGISTERED_CSV)
        else:
            reg_df = pd.DataFrame(columns=["name", "image"])
        reg_df = pd.concat([reg_df, pd.DataFrame([{"name": name, "image": filename}])], ignore_index=True)
        reg_df.to_csv(REGISTERED_CSV, index=False)
        return JsonResponse({"success": True, "message": "User registered"})
    return render(request, "voting_web/register_user.html")

def vote_panel(request):
    # Panel where voter verification + voting happens
    # Load parties for voting from Votes.xlsx
    if not os.path.exists(VOTES_XLSX):
        return JsonResponse({"success": False, "message": "Votes file missing."})
    df = pd.read_excel(VOTES_XLSX)
    parties = df['Party_Name'].tolist()
    return render(request, "voting_web/vote_panel.html", {"parties": parties})

@csrf_exempt
def increase_vote(request):
    # Expects POST JSON: {"color": "Party Name"}
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")
    data = json.loads(request.body)
    selected = data.get("color")
    if not selected:
        return JsonResponse({"success": False, "message": "No selection"})
    df = pd.read_excel(VOTES_XLSX)
    if selected not in df['Party_Name'].values:
        return JsonResponse({"success": False, "message": "Party not found"})
    df.loc[df['Party_Name'] == selected, 'Votes_Count'] += 1
    df.to_excel(VOTES_XLSX, index=False)
    return JsonResponse({"success": True})

@csrf_exempt
def reset_votes(request):
    # Expects POST JSON {"password": "Admin123"}
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")
    data = json.loads(request.body)
    entered_password = data.get("password")
    if entered_password == "Admin123":
        df = pd.read_excel(VOTES_XLSX)
        df['Votes_Count'] = 0
        df.to_excel(VOTES_XLSX, index=False)
        return JsonResponse({"success": True})
    else:
        return JsonResponse({"success": False})

def show_results(request):
    if not os.path.exists(VOTES_XLSX):
        return JsonResponse({"success": False, "message": "Votes file missing."})
    df = pd.read_excel(VOTES_XLSX)
    if df.empty:
        return JsonResponse({"success": False, "message": "No votes recorded yet."})
    winner = df[df['Votes_Count'] == df['Votes_Count'].max()]['Party_Name'].values[0]
    df_sorted = df.sort_values(by='Votes_Count', ascending=False)
    result_message = f"Winner: {winner}\n\nResults:\n"
    for _, row in df_sorted.iterrows():
        result_message += f"{row['Party_Name']}: {row['Votes_Count']}\n"
    return JsonResponse({"success": True, "message": result_message})

@csrf_exempt
def verify_face(request):
    """
    POST endpoint:
    - Accepts an uploaded image (photo) from voter or base64
    - Compares it against all registered images using DeepFace.verify
    - If match found: returns {"verified": True, "name": matched_name}
    - Else: {"verified": False}
    """
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")

    file = request.FILES.get("photo")
    if file is None:
        return JsonResponse({"verified": False, "message": "No photo uploaded"})

    # Save temp file
    tmp_name = f"temp_{int(datetime.utcnow().timestamp())}.jpg"
    tmp_path = os.path.join(settings.MEDIA_ROOT, tmp_name)
    with open(tmp_path, "wb+") as dest:
        for chunk in file.chunks():
            dest.write(chunk)

    # Load registered list
    if not os.path.exists(REGISTERED_CSV):
        os.remove(tmp_path)
        return JsonResponse({"verified": False, "message": "No registered users"})

    reg_df = pd.read_csv(REGISTERED_CSV)
    # iterate through registered images and verify
    verified_name = None
    for _, row in reg_df.iterrows():
        reg_image = os.path.join(REGISTERED_DIR, row['image'])
        if not os.path.exists(reg_image):
            continue
        try:
            # Use DeepFace.verify; enforce detection with builtin detector (opencv)
            result = DeepFace.verify(img_path=tmp_path, 
                                     db_path=None, 
                                     model_name='VGG-Face',
                                     detector_backend='opencv',
                                     enforce_detection=False,
                                     img2_path=reg_image)
            if result.get("verified"):
                verified_name = row['name']
                break
        except Exception as e:
            # ignore errors for particular image comparisons
            print("DeepFace error:", e)
            continue

    os.remove(tmp_path)
    if verified_name:
        return JsonResponse({"verified": True, "name": verified_name})
    else:
        return JsonResponse({"verified": False})
excel
import os
import json
import pandas as pd
from django.conf import settings
from django.shortcuts import render, redirect
from django.http import JsonResponse, HttpResponseBadRequest, HttpResponse
from django.views.decorators.csrf import csrf_exempt

# Face modules
from deepface import DeepFace
import cv2
import numpy as np
from datetime import datetime
from django.core.files.storage import default_storage
from django.core.files.base import ContentFile

DATA_DIR = settings.VOTING_DATA_DIR
POLL_LOGIN_XLSX = os.path.join(DATA_DIR, "pollingOfficerLogin.xlsx")
VOTES_XLSX = os.path.join(DATA_DIR, "Votes.xlsx")
REGISTERED_CSV = os.path.join(DATA_DIR, "registered.csv")
REGISTERED_DIR = os.path.join(settings.MEDIA_ROOT, "registered")

# Ensure dirs exist
os.makedirs(REGISTERED_DIR, exist_ok=True)
os.makedirs(DATA_DIR, exist_ok=True)

def index(request):
    return render(request, "voting_web/index.html")

def login_po(request):
    # Polling officer login (reads pollingOfficerLogin.xlsx)
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")
        if not os.path.exists(POLL_LOGIN_XLSX):
            return JsonResponse({"success": False, "message": "Login file missing."})
        df = pd.read_excel(POLL_LOGIN_XLSX)
        if any((df['username'] == username) & (df['password'] == password)):
            request.session['po_user'] = username
            return redirect('voting_web:panel')
        else:
            return render(request, "voting_web/login_po.html", {"error": "Invalid credentials"})
    return render(request, "voting_web/login_po.html")

def panel(request):
    # Panel for admin/polling officer
    if 'po_user' not in request.session:
        return redirect('voting_web:login_po')
    return render(request, "voting_web/panel_po.html")

def register_user(request):
    # Register a new voter (upload image & name)
    if request.method == "POST":
        name = request.POST.get("name")
        file = request.FILES.get("photo")
        if not name or not file:
            return JsonResponse({"success": False, "message": "Missing name or photo"})
        # Save image
        filename = f"{name}_{int(datetime.utcnow().timestamp())}.jpg"
        path = os.path.join(REGISTERED_DIR, filename)
        with open(path, "wb+") as dest:
            for chunk in file.chunks():
                dest.write(chunk)
        # Update registered.csv
        if os.path.exists(REGISTERED_CSV):
            reg_df = pd.read_csv(REGISTERED_CSV)
        else:
            reg_df = pd.DataFrame(columns=["name", "image"])
        reg_df = pd.concat([reg_df, pd.DataFrame([{"name": name, "image": filename}])], ignore_index=True)
        reg_df.to_csv(REGISTERED_CSV, index=False)
        return JsonResponse({"success": True, "message": "User registered"})
    return render(request, "voting_web/register_user.html")

def vote_panel(request):
    # Panel where voter verification + voting happens
    # Load parties for voting from Votes.xlsx
    if not os.path.exists(VOTES_XLSX):
        return JsonResponse({"success": False, "message": "Votes file missing."})
    df = pd.read_excel(VOTES_XLSX)
    parties = df['Party_Name'].tolist()
    return render(request, "voting_web/vote_panel.html", {"parties": parties})

@csrf_exempt
def increase_vote(request):
    # Expects POST JSON: {"color": "Party Name"}
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")
    data = json.loads(request.body)
    selected = data.get("color")
    if not selected:
        return JsonResponse({"success": False, "message": "No selection"})
    df = pd.read_excel(VOTES_XLSX)
    if selected not in df['Party_Name'].values:
        return JsonResponse({"success": False, "message": "Party not found"})
    df.loc[df['Party_Name'] == selected, 'Votes_Count'] += 1
    df.to_excel(VOTES_XLSX, index=False)
    return JsonResponse({"success": True})

@csrf_exempt
def reset_votes(request):
    # Expects POST JSON {"password": "Admin123"}
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")
    data = json.loads(request.body)
    entered_password = data.get("password")
    if entered_password == "Admin123":
        df = pd.read_excel(VOTES_XLSX)
        df['Votes_Count'] = 0
        df.to_excel(VOTES_XLSX, index=False)
        return JsonResponse({"success": True})
    else:
        return JsonResponse({"success": False})

def show_results(request):
    if not os.path.exists(VOTES_XLSX):
        return JsonResponse({"success": False, "message": "Votes file missing."})
    df = pd.read_excel(VOTES_XLSX)
    if df.empty:
        return JsonResponse({"success": False, "message": "No votes recorded yet."})
    winner = df[df['Votes_Count'] == df['Votes_Count'].max()]['Party_Name'].values[0]
    df_sorted = df.sort_values(by='Votes_Count', ascending=False)
    result_message = f"Winner: {winner}\n\nResults:\n"
    for _, row in df_sorted.iterrows():
        result_message += f"{row['Party_Name']}: {row['Votes_Count']}\n"
    return JsonResponse({"success": True, "message": result_message})

@csrf_exempt
def verify_face(request):
    """
    POST endpoint:
    - Accepts an uploaded image (photo) from voter or base64
    - Compares it against all registered images using DeepFace.verify
    - If match found: returns {"verified": True, "name": matched_name}
    - Else: {"verified": False}
    """
    if request.method != "POST":
        return HttpResponseBadRequest("POST required")

    file = request.FILES.get("photo")
    if file is None:
        return JsonResponse({"verified": False, "message": "No photo uploaded"})

    # Save temp file
    tmp_name = f"temp_{int(datetime.utcnow().timestamp())}.jpg"
    tmp_path = os.path.join(settings.MEDIA_ROOT, tmp_name)
    with open(tmp_path, "wb+") as dest:
        for chunk in file.chunks():
            dest.write(chunk)

    # Load registered list
    if not os.path.exists(REGISTERED_CSV):
        os.remove(tmp_path)
        return JsonResponse({"verified": False, "message": "No registered users"})

    reg_df = pd.read_csv(REGISTERED_CSV)
    # iterate through registered images and verify
    verified_name = None
    for _, row in reg_df.iterrows():
        reg_image = os.path.join(REGISTERED_DIR, row['image'])
        if not os.path.exists(reg_image):
            continue
        try:
            # Use DeepFace.verify; enforce detection with builtin detector (opencv)
            result = DeepFace.verify(img_path=tmp_path, 
                                     db_path=None, 
                                     model_name='VGG-Face',
                                     detector_backend='opencv',
                                     enforce_detection=False,
                                     img2_path=reg_image)
            if result.get("verified"):
                verified_name = row['name']
                break
        except Exception as e:
            # ignore errors for particular image comparisons
            print("DeepFace error:", e)
            continue

    os.remove(tmp_path)
    if verified_name:
        return JsonResponse({"verified": True, "name": verified_name})
    else:
        return JsonResponse({"verified": False})
template
<!doctype html>
<html>
<head><title>Admin Panel</title></head>
<body>
  <h2>Polling Officer Panel</h2>
  <ul>
    <li><a href="{% url 'voting_web:register_user' %}">Register a Voter</a></li>
    <li><a href="{% url 'voting_web:vote_panel' %}">Open Vote Panel</a></li>
    <li>
      <form id="resetForm">
        <input type="password" id="resetPass" placeholder="Admin Password" />
        <button type="button" onclick="resetVotes()">Reset Votes</button>
      </form>
    </li>
  </ul>

<script>
function resetVotes(){
  const pass = document.getElementById('resetPass').value;
  fetch("{% url 'voting_web:reset_votes' %}", {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({password: pass})
  }).then(res => res.json()).then(data => {
    alert(JSON.stringify(data));
  });
}
</script>

</body>
</html><!doctype html>
<html>
<head><title>Vote Panel</title></head>
<body>
  <h2>Vote Panel</h2>

  <h3>Step 1: Upload your photo for verification</h3>
  <input type="file" id="vphoto" accept="image/*" />
  <button onclick="verify()">Verify</button>
  <p id="verifyResult"></p>

  <div id="voting" style="display:none;">
    <h3>Step 2: Select Party</h3>
    {% for p in parties %}
      <button onclick="vote('{{ p }}')">{{ p }}</button>
    {% endfor %}
  </div>

<script>
let verifiedName = null;
function verify(){
  const f = document.getElementById('vphoto').files[0];
  if(!f){ alert('Upload a photo'); return; }
  const fd = new FormData();
  fd.append('photo', f);
  fetch("{% url 'voting_web:verify_face' %}", {
    method: 'POST',
    body: fd
  }).then(r => r.json()).then(j => {
    if(j.verified){
      verifiedName = j.name;
      document.getElementById('verifyResult').innerText = "Verified as: " + j.name;
      document.getElementById('voting').style.display = "block";
    } else {
      document.getElementById('verifyResult').innerText = "Not verified: " + (j.message||'');
      document.getElementById('voting').style.display = "none";
    }
  });
}

function vote(party){
  if(!verifiedName){ alert('Verify first'); return; }
  fetch("{% url 'voting_web:increase_vote' %}", {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({color: party})
  }).then(r => r.json()).then(j => {
    if(j.success) alert('Vote recorded. Thank you!');
    else alert('Vote error: ' + (j.message||''));
  });
}
</script>
</body>
</html>
